#!/bin/bash

set -e

FIRST_RUN_MODE=~/.local/state/mimiron/first-run.mode
MIMIRON_PATH="$HOME/.local/share/mimiron"

if [[ -f "$FIRST_RUN_MODE" ]]; then
  # Remove marker file (ensures this only runs once)
  rm -f "$FIRST_RUN_MODE"

  # Run first-run scripts in order
  bash "$MIMIRON_PATH/install/first-run/dns-resolver.sh"
  bash "$MIMIRON_PATH/install/first-run/firewall.sh"
  bash "$MIMIRON_PATH/install/first-run/gnome-extensions.sh"

  # Cleanup temporary sudoers
  sudo rm -f /etc/sudoers.d/first-run

  # Welcome notifications
  bash "$MIMIRON_PATH/install/first-run/welcome.sh"
fi
