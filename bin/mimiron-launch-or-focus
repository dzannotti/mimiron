#!/bin/bash

# Launch or focus an application window (GNOME Wayland compatible)
# Usage: mimiron-launch-or-focus [window-pattern] [launch-command]

if (($# == 0)); then
  echo "Usage: mimiron-launch-or-focus [window-pattern] [launch-command]"
  exit 1
fi

WINDOW_PATTERN="$1"
LAUNCH_COMMAND="${2:-"$WINDOW_PATTERN"}"

# Try wmctrl first (works for most apps like VSCode, Obsidian, Ferdium)
WINDOW_ID=$(wmctrl -lx | grep -i "$WINDOW_PATTERN" | head -n1 | awk '{print $1}')

if [[ -n $WINDOW_ID ]]; then
  # Window found via wmctrl, focus it
  wmctrl -ia "$WINDOW_ID"
  exit 0
fi

# Fallback: For apps wmctrl can't see (like Chrome on Wayland)
# Check if process is already running - if so, don't launch duplicate
# User can use Alt+Tab or Activities to switch to the existing window
if pgrep -x "chrome" > /dev/null 2>&1 && [[ "$WINDOW_PATTERN" == "chrome" ]]; then
  # Chrome is already running, don't launch another instance
  # Just exit - user can Alt+Tab to it
  exit 0
fi

if pgrep -x "ghostty" > /dev/null 2>&1 && [[ "$WINDOW_PATTERN" == "ghostty" ]]; then
  # Ghostty is already running
  exit 0
fi

# Window doesn't exist, launch the application
eval exec "$LAUNCH_COMMAND" &
