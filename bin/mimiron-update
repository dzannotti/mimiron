#!/bin/bash

# System update script with snapshot creation and restart detection

set -e

trap 'echo ""; echo -e "\033[0;31mSomething went wrong during the update!\n\nPlease review the output above carefully, correct the error, and retry the update.\033[0m"' ERR

echo "Starting system update..."

# Create snapshot if snapper is available
if command -v snapper &>/dev/null; then
  echo "Creating pre-update snapshot..."
  sudo snapper -c root create --description "Before system update"
fi

# Update the mimiron repo
echo "Updating Mimiron..."
cd ~/.local/share/mimiron
git pull

# Update system packages
echo "Updating system packages..."
yay -Syu --noconfirm

echo "Update complete!"

# Check if restart is needed
mimiron-update-restart
